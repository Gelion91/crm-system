{% extends "base_generic.html" %}
{% load crispy_forms_tags %}


{% block content %}
    <div class="row" >

        <div class="col-lg-12 secondcolor pad_list" style="background-color:#f5f5f5;">
            <br>
                <button class="btn btn-outline-secondary" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasScrolling" aria-controls="offcanvasScrolling">Фильтры</button>
                <div class="offcanvas offcanvas-end" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1" id="offcanvasScrolling" aria-labelledby="offcanvasScrollingLabel">

                    <div class="offcanvas-header">
                        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Закрыть"></button>
                    </div>

                    <div class="offcanvas-body">
                         <form action="" method="get">
                            {{ filter.form|crispy }}
                         <button class="btn btn-outline-secondary" type="submit">Поиск</button>
                         </form>
                    </div>

                </div>
            <hr>
        {% if object_list %}
        <div class="row" style="margin-top:1%; margin-bottom:1%;">
            <div class="col"><p class="p-size">Маркировка</p></div>
            <div class="col"><p class="p-size">Наименование</p></div>
            <div class="col"><p class="p-size">Оплачен</p></div>
            <div class="col"><p class="p-size">Прибыл</p></div>
        </div>
          {% for obj in object_list %}
            <div class="row list-height" style="font-weight: 700; border-color:#bbddfd; margin-top:1%; margin-bottom:1%; background-color:#fff;">
                <div class="col"><p>{{obj.product_marker}}</p></div>
                <div class="col"><p>{{obj.name}}</p></div>
                <div class="col"><input id="paid_{{obj.pk}}" name="{{obj.pk}}" class="toggle_paid checkbox_margin" type="checkbox" {% if obj.paid %} checked="true" {% endif %}></div>
                <div class="col"><input id="arrive_{{obj.pk}}" name="{{obj.pk}}" class="toggle_arrive checkbox_margin" type="checkbox" {% if obj.arrive %} checked="true" {% endif %}></div>
            </div>
            {% endfor %}
        {% else %}
    <h3>Нет товаров.</h3>
    </div>
    </div>
    {% endif %}
<script>

    $('.toggle_paid').click(function() {
    var checked_paid = $(this).is(':checked');
    console.log(checked_paid);
    console.log($(this).attr('id'))
    console.log($(this).attr('name'))

    $.ajax({

        type: "POST",
        url: "{% url 'core:change_status_paid' %}",
        data: { checked: checked_paid,
                id: $(this).attr('name'),
                csrfmiddlewaretoken: '{{ csrf_token }}'},
        success: function(response) {
        console.log(response)
        console.log('it work');
        },
        error: function() {
            console.log('it broke');
        },
    });
});

$('.toggle_arrive').click(function() {
    var checked_arrive = $(this).is(':checked');
    console.log(checked_arrive);
    console.log($(this).attr('id'))
    console.log($(this).attr('name'))

    $.ajax({

        type: "POST",
        url: "{% url 'core:change_status_arrive' %}",
        data: { checked: checked_arrive,
                id: $(this).attr('name'),
                csrfmiddlewaretoken: '{{ csrf_token }}'},
        success: function(response) {
        console.log('it work');
        },
        error: function() {
            console.log('it broke');
        },
    });
});
  </script>
{% endblock %}